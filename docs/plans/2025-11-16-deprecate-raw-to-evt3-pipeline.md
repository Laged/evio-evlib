# Deprecate Raw-to-EVT3 Pipeline Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Safely deprecate the failed `.raw ‚Üí _evt3.dat` conversion pipeline while preserving all working evlib tools and legacy export functionality.

**Architecture:** Remove misleading raw-to-evt3 tooling that incorrectly assumed .raw files were conversions of legacy .dat files. Keep the proven legacy-dat-to-hdf5 pipeline and evlib experimentation tools. Update documentation to reflect actual dataset reality.

**Tech Stack:** Bash scripting, Nix flake configuration, Python utilities, Git version control

**Context:** Investigation proved that `.raw` files are independent IDS camera recordings (Nov 2025) with different resolutions (2040√ó1793 vs 1280√ó720), durations (682-717s vs 9-24s), and broken polarity encoding. They are NOT conversions of legacy `.dat` files and cannot be used for parity testing. See `docs/plans/raw-to-evt3-deprecation.md` for evidence.

---

## Pre-Flight Safety: Commit Working Tools

**CRITICAL:** Before ANY removals, commit all working tools to ensure they're preserved in git history.

### Task 1: Git Safety Checkpoint

**Files:**
- Verify: `scripts/convert_legacy_dat_to_hdf5.py`
- Verify: `scripts/convert_all_legacy_to_hdf5.sh`
- Verify: `evio/src/evio/core/legacy_export.py`
- Verify: `workspace/tools/evlib-examples/*`
- Verify: `workspace/libs/evio-core/tests/test_evlib_comparison.py`

**Step 1: Check git status for uncommitted changes**

Run: `git status --short`
Expected: Clean working tree (all legacy export tools already committed)

**Step 2: Verify legacy export tools are committed**

Run: `git log --oneline --all --grep="legacy" --grep="export" --grep="HDF5" -i | head -20`
Expected: Recent commits showing legacy export implementation

**Step 3: Verify evlib-examples tools are committed**

Run: `git log --oneline -- workspace/tools/evlib-examples/ | head -10`
Expected: Commits showing evlib-examples creation

**Step 4: Create safety tag before deprecation**

```bash
git tag -a pre-raw-evt3-deprecation -m "Safety tag: all working evlib tools before raw-to-evt3 deprecation"
git tag -l "pre-raw-*"
```

Expected: Tag created successfully

**Step 5: Document safety measures**

No commit needed - verification only

---

## Phase 1: Update Documentation (Safe, Reversible)

### Task 2: Clarify Dataset Reality in datasets.md

**Files:**
- Modify: `docs/data/datasets.md:1-100`

**Step 1: Add prominent warning about .raw files**

Edit `docs/data/datasets.md` to strengthen the warning at the top:

```markdown
# Dataset Manifest

This document catalogs all datasets in `evio/data/junction-sensofusion.zip`.

**CRITICAL DISTINCTION:** The ZIP contains TWO completely independent dataset collections:

1. **Legacy Sensofusion .dat files** - Original recordings for parity testing
2. **IDS Camera .raw files (EVT3)** - NEW separate recordings from Nov 2025

‚ö†Ô∏è **THESE ARE NOT THE SAME RECORDINGS!** Do NOT use .raw files for legacy parity testing.

See `docs/plans/raw-to-evt3-deprecation.md` for diagnostic evidence proving they are different captures.
```

**Step 2: Move raw-to-evt3 conversion section to appendix**

Move the "IDS .raw ‚Üí .dat (Header Preservation)" section under a new heading:

```markdown
## APPENDIX: Experimental IDS Data Conversion (Not for Legacy Parity)

### IDS .raw ‚Üí .dat (Header Preservation)
Generated by `convert-all-datasets` (DEPRECATED - use for IDS experimentation only):

| File | Source | Events | Format |
|------|--------|--------|--------|
| `fan/fan_const_rpm_evt3.dat` | `fan_const_rpm.raw` | 30.4M | EVT3 .dat container |

**‚ö†Ô∏è WARNING:** These files are NOT suitable replacements for legacy .dat files.
They are different recordings from different hardware with:
- Different resolutions (2040√ó1793 vs 1280√ó720)
- Different durations (682s vs 9.5s)
- Different event counts (30M vs 26M)
- Broken polarity encoding (0 OFF events)

Use ONLY for evlib performance testing or IDS-specific experiments.
For legacy parity, use `*_legacy.h5` files exported via `convert-legacy-dat-to-hdf5`.
```

**Step 3: Run documentation build/validation**

Run: `grep -n "raw.*evt3\|_evt3\.dat" docs/data/datasets.md`
Expected: All references clearly marked as experimental/deprecated

**Step 4: Commit documentation update**

```bash
git add docs/data/datasets.md
git commit -m "docs: clarify .raw files are not legacy conversions

- Add critical distinction warning at top of datasets.md
- Move raw-to-evt3 conversion to experimental appendix
- Document evidence that .raw files are separate IDS recordings
- Prevent future confusion about dataset sources"
```

---

### Task 3: Update evlib-integration.md with Deprecation Notice

**Files:**
- Modify: `docs/evlib-integration.md:36-99`

**Step 1: Mark Section 3 as deprecated**

Add deprecation notice to the "Requirements & Dataset Reality" section:

```markdown
## 3. Requirements & Dataset Reality (DEPRECATED - See Section 10)

‚ö†Ô∏è **DEPRECATION NOTICE:** This section documents a failed approach.
The assumption that .raw files were conversions of legacy .dat files was incorrect.

**See Section 10 for the correct approach:** Legacy .dat ‚Üí HDF5 export via evlib schema.

### Original Assumption (INCORRECT)
[keep existing content]
```

**Step 2: Update Section 4 heading**

```markdown
## 4. Implementation Plan (DEPRECATED - OpenEB approach abandoned)

‚ö†Ô∏è **This plan was not implemented.** OpenEB conversion was unnecessary.
Instead, we implemented direct legacy .dat ‚Üí HDF5 export (see Section 10).

[keep existing content for historical reference]
```

**Step 3: Add cross-references to working solution**

At the end of Section 4, add:

```markdown
---

**Actual Implementation:** See Section 10 for the working legacy export pipeline.
**Diagnostic Evidence:** See `docs/plans/raw-to-evt3-deprecation.md` for proof that .raw ‚â† legacy .dat.
```

**Step 4: Verify section 10 is clear**

Run: `grep -A5 "^## 10" docs/evlib-integration.md`
Expected: Section 10 describes legacy export to HDF5

**Step 5: Commit documentation clarification**

```bash
git add docs/evlib-integration.md
git commit -m "docs: mark raw-to-evt3 sections as deprecated

- Add deprecation notices to sections 3-4
- Cross-reference working legacy export solution (Section 10)
- Keep failed approach for historical context
- Prevent future developers from repeating mistakes"
```

---

### Task 4: Update evio-data-format.md

**Files:**
- Modify: `docs/data/evio-data-format.md`

**Step 1: Add note about _evt3.dat files**

Search for references to EVT3 format and add clarification:

Run: `grep -n "evt3\|EVT3" docs/data/evio-data-format.md`

**Step 2: Add experimental data section**

Near the end of the document, add:

```markdown
## Experimental: IDS Camera Recordings

The repository contains .raw files from IDS Imaging cameras (Nov 2025) in EVT3 format.
These are **separate recordings** from different hardware, not conversions of legacy .dat files.

**Key differences from legacy data:**
- Resolution: Header claims 1280√ó720, events span ~2040√ó1793
- Duration: 682-717 seconds (vs 9-24 seconds for legacy)
- Polarity: All show 0 OFF events (encoding issue)

**Usage:** Experimental evlib testing only. NOT for legacy parity validation.

See `docs/data/datasets.md` for complete manifest.
```

**Step 3: Verify formatting**

Run: `head -100 docs/data/evio-data-format.md | grep "^##"`
Expected: Section headers display correctly

**Step 4: Commit format documentation update**

```bash
git add docs/data/evio-data-format.md
git commit -m "docs: document experimental IDS .raw recordings

- Add section explaining IDS camera data vs legacy Sensofusion
- Clarify .raw files are not suitable for parity testing
- Cross-reference datasets.md for complete manifest"
```

---

## Phase 2: Update Nix Configuration (User-Facing Changes)

### Task 5: Update flake.nix shellHook Messages

**Files:**
- Modify: `flake.nix:268-324`

**Step 1: Relabel convert-all-datasets command**

Find the shellHook section and update the banner:

```nix
echo "üìä Dataset Management:"
echo "  unzip-datasets              : Extract junction-sensofusion.zip"
echo "  download-datasets           : Download from Google Drive (~1.4 GB)"
echo ""
echo "üì¶ Legacy Data Export (RECOMMENDED):"
echo "  convert-legacy-dat-to-hdf5  : Convert single legacy .dat to evlib HDF5"
echo "  convert-all-legacy-to-hdf5  : Convert ALL legacy .dat to evlib HDF5"
echo ""
echo "üß™ Experimental (IDS Camera Data):"
echo "  convert-all-datasets        : Convert .raw to _evt3.dat (IDS only, not legacy)"
echo "  convert-evt3-raw-to-dat     : Manual .raw ‚Üí .dat (experimental)"
echo ""
```

**Step 2: Update demo aliases description**

```nix
echo "Demo Aliases:"
echo "  run-demo-fan         : Play fan dataset (legacy loader)"
echo "  run-demo-fan-ev3     : Play fan dataset (evlib on legacy HDF5 export)"
echo "  run-mvp-1            : MVP 1 - Event density"
echo "  run-mvp-2            : MVP 2 - Voxel FFT"
echo ""
echo "NOTE: run-demo-fan-ev3 uses legacy export (requires convert-legacy-dat-to-hdf5)"
echo ""
echo "üìà Experimental IDS Data Sandbox:"
echo "  run-evlib-raw-demo   : Load .raw with evlib (IDS camera, not legacy)"
echo "  run-evlib-raw-player : Real-time .raw playback (IDS camera, not legacy)"
echo ""
```

**Step 3: Test flake syntax**

Run: `nix flake check`
Expected: No syntax errors

**Step 4: Test shell activation**

Run: `nix develop --command echo "Shell loaded successfully"`
Expected: Banner displays with updated messages

**Step 5: Commit flake.nix updates**

```bash
git add flake.nix
git commit -m "feat: clarify dataset conversion commands in shell banner

- Separate legacy export (recommended) from IDS experimental tools
- Label convert-all-datasets as IDS-only (not legacy conversion)
- Update demo descriptions to reference correct data sources
- Help prevent confusion about which conversion to use"
```

---

### Task 6: Deprecate convert-evt3-raw-to-dat Script (Keep for Reference)

**Files:**
- Modify: `scripts/convert_evt3_raw_to_dat.py:1-20`

**Step 1: Add deprecation warning to docstring**

```python
#!/usr/bin/env python3
"""
‚ö†Ô∏è DEPRECATION WARNING ‚ö†Ô∏è

This script operates on IDS camera .raw files (Nov 2025) which are SEPARATE recordings
from the legacy Sensofusion .dat files. They cannot be used for legacy parity testing.

For legacy data export, use: scripts/convert_legacy_dat_to_hdf5.py

This tool is preserved for IDS-specific experimentation only.

---

Convert EVT3 .raw files to .dat format while patching metadata to match actual stats.

This script now inspects the raw events via evlib before copying bytes so we can
log true resolution/duration/polarity counts and optionally fix the header fields
(`height`, `width`, `geometry`) when they are incorrect.

Usage:
    python scripts/convert_evt3_raw_to_dat.py <input.raw> [output.dat]

If output is not specified, creates <input>_evt3.dat in the same directory.

See docs/plans/raw-to-evt3-deprecation.md for evidence this approach was abandoned.
"""
```

**Step 2: Add runtime warning**

At the start of `main()` function, add:

```python
def main() -> int:
    """Main entry point."""
    # Deprecation warning
    print("=" * 70)
    print("‚ö†Ô∏è  DEPRECATION WARNING")
    print("=" * 70)
    print()
    print("This tool converts IDS camera .raw files (separate recordings).")
    print("It does NOT convert legacy Sensofusion .dat files.")
    print()
    print("For legacy data export, use:")
    print("  nix develop --command convert-legacy-dat-to-hdf5 <file.dat>")
    print()
    print("Continuing with experimental IDS conversion...")
    print("=" * 70)
    print()

    args = parse_args()
    # [rest of function]
```

**Step 3: Test script still runs**

Run: `python scripts/convert_evt3_raw_to_dat.py --help`
Expected: Help message displays with deprecation warning

**Step 4: Commit deprecation markers**

```bash
git add scripts/convert_evt3_raw_to_dat.py
git commit -m "deprecate: mark convert_evt3_raw_to_dat.py as experimental only

- Add clear deprecation warning in docstring
- Add runtime warning explaining IDS vs legacy data
- Direct users to convert-legacy-dat-to-hdf5 for real work
- Keep script functional for IDS experimentation"
```

---

## Phase 3: Clean Up Test References (Optional)

### Task 7: Audit Test Files for _evt3.dat References

**Files:**
- Review: `workspace/libs/evio-core/tests/test_evlib_comparison.py`
- Review: All test files in `workspace/libs/evio-core/tests/`

**Step 1: Search for _evt3.dat references in tests**

Run: `grep -rn "_evt3\.dat\|evt3.*dat" workspace/libs/evio-core/tests/`
Expected: Should find no references (tests use *_legacy.h5 files)

**Step 2: Search for convert_evt3 references**

Run: `grep -rn "convert_evt3\|raw.*to.*dat" workspace/libs/evio-core/tests/`
Expected: Should find no references

**Step 3: Verify test suite uses correct files**

Run: `grep -rn "legacy\.h5" workspace/libs/evio-core/tests/`
Expected: Tests reference *_legacy.h5 files, not _evt3.dat

**Step 4: Run test suite to confirm**

Run: `nix develop --command uv run --package evio-core pytest workspace/libs/evio-core/tests/ -v`
Expected: All tests pass (16/16)

**Step 5: Document verification**

No commit needed - verification confirms tests already use correct files

---

### Task 8: Update README Files

**Files:**
- Modify: `workspace/tools/evlib-examples/README.md`
- Review: `workspace/libs/evio-core/README.md`

**Step 1: Update evlib-examples README**

Add clarification to the top:

```markdown
# evlib-examples

Experimental tools for exploring EVT3 .raw files from IDS cameras using evlib.

‚ö†Ô∏è **IMPORTANT:** These tools operate on .raw files which are SEPARATE recordings
from the legacy Sensofusion .dat files in the repository.

**For legacy data work:** Use `convert-legacy-dat-to-hdf5` instead.

**This package is for:**
- IDS camera data experimentation
- evlib performance testing
- Raw EVT3 format exploration

[rest of existing content]
```

**Step 2: Check evio-core README for misleading references**

Run: `grep -i "raw\|evt3" workspace/libs/evio-core/README.md`
Expected: Should reference legacy export, not raw conversion

**Step 3: Commit README updates**

```bash
git add workspace/tools/evlib-examples/README.md
git commit -m "docs: clarify evlib-examples purpose

- Add warning that .raw files are separate IDS recordings
- Direct legacy work to convert-legacy-dat-to-hdf5
- Explain package is for IDS experimentation only"
```

---

## Phase 4: Archive Diagnostic Evidence

### Task 9: Preserve Diagnostic Scripts

**Files:**
- Keep: `scripts/compare_all_fan_files.py`
- Keep: `scripts/diagnose_fan_data.py`
- Modify: Add README explaining their purpose

**Step 1: Create diagnostics README**

Create: `scripts/DIAGNOSTICS.md`

```markdown
# Dataset Diagnostic Scripts

These scripts were used to prove that .raw files are NOT conversions of legacy .dat files.

## Evidence Scripts (Preserved for Historical Reference)

### compare_all_fan_files.py
Compares legacy .dat files vs .raw files side-by-side.

**Key findings:**
- Event counts differ (26M vs 30M)
- Resolutions differ (1280√ó720 vs 2040√ó1793)
- Durations differ (9.5s vs 682s)
- Polarity distributions differ (balanced vs broken)

### diagnose_fan_data.py
Logs detailed header and event statistics for fan dataset files.

**Key findings:**
- Headers claim 1280√ó720 but events extend to 2040√ó1793
- .raw files show 0 OFF events (encoding bug)
- Metadata mismatch indicates separate recordings

## Usage

These scripts are preserved for documentation but not part of the normal workflow.

Run to verify the dataset distinction:

```bash
nix develop --command uv run python scripts/compare_all_fan_files.py
nix develop --command uv run python scripts/diagnose_fan_data.py
```

See `docs/plans/raw-to-evt3-deprecation.md` for complete analysis.
```

**Step 2: Verify scripts still execute**

Run: `nix develop --command uv run python scripts/compare_all_fan_files.py --help || echo "No --help flag"`
Expected: Script exists and is executable

**Step 3: Commit diagnostics documentation**

```bash
git add scripts/DIAGNOSTICS.md
git commit -m "docs: preserve diagnostic script documentation

- Document purpose of compare_all_fan_files.py and diagnose_fan_data.py
- Summarize key findings proving .raw ‚â† legacy .dat
- Mark as historical reference (not normal workflow)
- Cross-reference raw-to-evt3-deprecation.md"
```

---

## Phase 5: Optional Cleanup (Can Be Deferred)

### Task 10: Consider Moving convert_evt3_raw_to_dat.py

**Files:**
- Potential move: `scripts/convert_evt3_raw_to_dat.py` ‚Üí `workspace/tools/evlib-examples/scripts/`

**Step 1: Evaluate if move is worth the disruption**

Consider:
- Script is already deprecated with warnings
- Still referenced in flake.nix
- Move would require flake.nix path updates
- Historical git blame would be harder to track

**Step 2: Decision checkpoint**

Ask user: "Should we move convert_evt3_raw_to_dat.py to evlib-examples/scripts/, or leave it in scripts/ with deprecation warnings?"

**Recommended:** Leave in place with deprecation warnings (less disruptive)

**Step 3: If moving (optional):**

```bash
git mv scripts/convert_evt3_raw_to_dat.py workspace/tools/evlib-examples/scripts/
# Update flake.nix convertEvt3Script path
git add flake.nix
git commit -m "refactor: move convert_evt3_raw_to_dat to evlib-examples

- Relocate experimental IDS tool to appropriate package
- Update flake.nix script path
- Keep historical git blame with git log --follow"
```

**Step 4: If NOT moving (recommended):**

Document decision:

```bash
# Add note to scripts/DIAGNOSTICS.md
echo "" >> scripts/DIAGNOSTICS.md
echo "### convert_evt3_raw_to_dat.py" >> scripts/DIAGNOSTICS.md
echo "Deprecated but kept in scripts/ for compatibility." >> scripts/DIAGNOSTICS.md
echo "Marked with runtime warnings. See flake.nix for shell command." >> scripts/DIAGNOSTICS.md

git add scripts/DIAGNOSTICS.md
git commit -m "docs: document decision to keep convert_evt3_raw_to_dat in scripts/

- Tool is deprecated but functional
- Keeping in place avoids flake.nix disruption
- Clear warnings prevent misuse"
```

---

## Phase 6: Final Verification

### Task 11: End-to-End Workflow Test

**Files:**
- Test: All documented workflows still function

**Step 1: Test legacy export workflow**

```bash
# Remove existing HDF5 file
rm -f evio/data/fan/fan_const_rpm_legacy.h5

# Convert legacy .dat to HDF5
nix develop --command convert-legacy-dat-to-hdf5 evio/data/fan/fan_const_rpm.dat

# Verify output
ls -lh evio/data/fan/fan_const_rpm_legacy.h5
```

Expected: File created successfully (~202 MB)

**Step 2: Test demo with legacy HDF5**

```bash
# Run evlib demo (should use legacy export)
nix develop --command bash -c 'run-demo-fan-ev3'
```

Expected: Demo runs on correct file (fan_const_rpm_legacy.h5)

**Step 3: Test parity tests**

```bash
nix develop --command uv run --package evio-core pytest workspace/libs/evio-core/tests/test_evlib_comparison.py -v
```

Expected: 16/16 tests pass

**Step 4: Test experimental IDS tools (should still work)**

```bash
# Test raw demo (experimental)
nix develop --command bash -c 'run-evlib-raw-demo evio/data/fan/fan_const_rpm.raw'
```

Expected: Runs with deprecation context clear

**Step 5: Verify shell banner clarity**

```bash
nix develop --command bash -c 'echo "Banner displayed above"'
```

Expected: Banner clearly separates legacy export from IDS experimental tools

---

### Task 12: Documentation Cross-Check

**Files:**
- Review: All updated documentation files

**Step 1: Verify documentation consistency**

```bash
# Check all mentions of _evt3.dat are properly contextualized
grep -rn "_evt3\.dat" docs/ | grep -v "experimental\|IDS\|DEPRECATED"
```

Expected: No unmarked references to _evt3.dat

**Step 2: Verify legacy export documentation is prominent**

```bash
grep -rn "convert-legacy-dat-to-hdf5" docs/ | wc -l
```

Expected: Multiple references showing it as primary method

**Step 3: Check for orphaned raw-to-evt3 instructions**

```bash
grep -rn "convert.*raw.*to.*dat\|metavision\|openeb" docs/ -i | grep -v "DEPRECATED\|experimental"
```

Expected: No active instructions for abandoned OpenEB approach

**Step 4: Generate documentation summary**

```bash
cat > docs/DEPRECATION-SUMMARY.md << 'EOF'
# Raw-to-EVT3 Pipeline Deprecation Summary

**Date:** 2025-11-16

## What Was Deprecated

The `convert-evt3-raw-to-dat` pipeline that assumed .raw files were conversions of legacy .dat files.

## Why

Investigation proved .raw files are separate IDS camera recordings with:
- Different hardware (IDS vs Sensofusion)
- Different resolutions (2040√ó1793 vs 1280√ó720)
- Different durations (682s vs 9.5s)
- Broken polarity (0 OFF events)

See `docs/plans/raw-to-evt3-deprecation.md` for diagnostic evidence.

## What Replaced It

**Legacy export pipeline:** `convert-legacy-dat-to-hdf5`
- Exports actual Sensofusion .dat files to evlib HDF5
- Enables true legacy vs evlib parity testing
- All tests pass (16/16)

## What Was Preserved

1. **Working tools (KEEP USING):**
   - `convert-legacy-dat-to-hdf5` - Legacy export to HDF5
   - `convert-all-legacy-to-hdf5` - Batch legacy export
   - `workspace/tools/evlib-examples/*` - IDS .raw experimentation
   - All parity tests in `test_evlib_comparison.py`

2. **Experimental tools (LIMITED USE):**
   - `convert-evt3-raw-to-dat` - IDS .raw ‚Üí .dat (experimental)
   - Diagnostic scripts in `scripts/` (historical reference)

## Migration Guide

**Old (WRONG):**
```bash
convert-all-datasets  # Thought this gave us legacy data in EVT3 format
run-demo-fan-ev3      # Thought this played the same recording as run-demo-fan
```

**New (CORRECT):**
```bash
convert-all-legacy-to-hdf5  # Export actual legacy data to HDF5
run-demo-fan-ev3             # Now plays the SAME recording via evlib
```

## For Future Developers

- Use `*_legacy.h5` files for all legacy parity work
- Use `.raw` files only for IDS-specific experiments
- Never assume .raw = legacy .dat without verification
- Read `docs/data/datasets.md` for complete dataset manifest
EOF

git add docs/DEPRECATION-SUMMARY.md
```

**Step 5: Commit final documentation**

```bash
git commit -m "docs: add deprecation summary for future reference

- Explain what was deprecated and why
- Document what replaced the failed pipeline
- Provide migration guide from old to new workflows
- List preserved tools and their purposes"
```

---

### Task 13: Final Commit and Branch Summary

**Files:**
- All modified files

**Step 1: Review all changes**

```bash
git log --oneline HEAD...pre-raw-evt3-deprecation
```

Expected: ~10 commits documenting deprecation steps

**Step 2: Check for uncommitted changes**

```bash
git status
```

Expected: Clean working tree

**Step 3: Verify safety tag exists**

```bash
git tag -l "pre-raw-*"
```

Expected: `pre-raw-evt3-deprecation` tag present

**Step 4: Generate final branch summary**

```bash
cat > /tmp/branch-summary.txt << 'EOF'
Branch: evlib-integration
Status: Raw-to-EVT3 Deprecation Complete

What Changed:
- Deprecated convert-evt3-raw-to-dat (IDS experiments only)
- Updated docs to clarify .raw ‚â† legacy .dat
- Reorganized flake.nix banner (legacy export prominent)
- Added deprecation warnings to experimental tools
- Preserved all working legacy export tooling

Safety Measures:
- Pre-deprecation tag: pre-raw-evt3-deprecation
- All working tools committed before changes
- No functional code deleted (only deprecated)
- All tests still pass (16/16)

Next Steps:
- Visual smoke tests (frame-by-frame comparison)
- Consider legacy loader deprecation after confidence builds
- Monitor for .raw usage in wild (should be minimal)

Working Tools (KEEP):
‚úÖ convert-legacy-dat-to-hdf5
‚úÖ convert-all-legacy-to-hdf5
‚úÖ workspace/tools/evlib-examples
‚úÖ test_evlib_comparison.py (16/16 passing)

Experimental Tools (LIMITED):
‚ö†Ô∏è convert-evt3-raw-to-dat (IDS only, deprecated)
‚ö†Ô∏è run-evlib-raw-demo (IDS only)
EOF

cat /tmp/branch-summary.txt
```

**Step 5: Commit verification summary**

```bash
git add docs/
git commit -m "chore: verify raw-to-evt3 deprecation complete

- All working tools preserved and tested
- Documentation updated consistently
- Safety tag created before changes
- Migration guide provided for users
- Test suite passes (16/16)

Next: Visual smoke tests, then consider legacy deprecation"
```

---

## Success Criteria

**Documentation:**
- [x] datasets.md clearly separates IDS vs legacy data
- [x] evlib-integration.md marks failed sections as deprecated
- [x] flake.nix banner reorganized (legacy prominent, IDS experimental)
- [x] DEPRECATION-SUMMARY.md created for future reference

**Code Safety:**
- [x] All working tools committed before changes
- [x] Safety tag created (pre-raw-evt3-deprecation)
- [x] No functional tools deleted
- [x] Test suite passes (16/16)

**User Experience:**
- [x] Shell banner guides users to correct tools
- [x] Experimental tools show deprecation warnings
- [x] Migration path documented clearly
- [x] README files updated with context

**Verification:**
- [x] Legacy export workflow tested end-to-end
- [x] Demos run on correct files
- [x] Parity tests pass
- [x] Experimental IDS tools still functional (for those who want them)

---

## Rollback Plan (If Needed)

If deprecation causes issues:

```bash
# Restore to pre-deprecation state
git checkout pre-raw-evt3-deprecation

# Or cherry-pick specific reverts
git log --oneline HEAD...pre-raw-evt3-deprecation
git revert <commit-sha>
```

All working tools were committed before deprecation, so rollback is safe.

---

## Notes for Executor

- This plan is primarily documentation and warning updates (safe)
- No critical code is deleted (only deprecated)
- Tests should pass throughout (run after each phase)
- If user pushback on deprecation warnings, can soften language
- Diagnostic scripts preserved for historical verification
- Can defer Phase 5 (optional cleanup) if time-constrained
